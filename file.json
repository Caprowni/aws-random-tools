{
    "Resources": {
        "BastionServer": {
            "DependsOn": [
                "bastionsg"
            ],
            "Properties": {
                "AvailabilityZone": "eu-west-1a",
                "ImageId": "ami-0284c77b",
                "InstanceType": "t2.micro",
                "KeyName": "SS-DEV",
                "SecurityGroupIds": [
                    {
                        "Ref": "bastionsg"
                    }
                ],
                "SubnetId": "subnet-07c3db60",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "bastion-server"
                    }
                ]
            },
            "Type": "AWS::EC2::Instance"
        },
        "bastionsg": {
            "Properties": {
                "GroupDescription": "SG for bastion server",
                "GroupName": "tb-bastion-sg",
                "VpcId": "vpc-8c966fea"
            },
            "Type": "AWS::EC2::SecurityGroup"
        },
        "inboundaccess0": {
            "DependsOn": [
                "bastionsg"
            ],
            "Properties": {
                "CidrIp": "172.24.246.0/23",
                "Description": "Allow MGMT access inbound from VDM",
                "FromPort": 3389,
                "GroupId": {
                    "Fn::GetAtt": [
                        "bastionsg",
                        "GroupId"
                    ]
                },
                "IpProtocol": "TCP",
                "ToPort": 3389
            },
            "Type": "AWS::EC2::SecurityGroupIngress"
        },
        "proxyaccess": {
            "DependsOn": [
                "bastionsg"
            ],
            "Properties": {
                "CidrIp": "10.112.64.0/18",
                "Description": "Allow access to proxy",
                "FromPort": 8080,
                "GroupId": {
                    "Fn::GetAtt": [
                        "bastionsg",
                        "GroupId"
                    ]
                },
                "IpProtocol": "TCP",
                "ToPort": 8080
            },
            "Type": "AWS::EC2::SecurityGroupEgress"
        },
        "proxywebaccess": {
            "DependsOn": [
                "bastionsg"
            ],
            "Properties": {
                "CidrIp": "10.112.64.0/18",
                "Description": "Allow access to proxy web interface",
                "FromPort": "443",
                "GroupId": {
                    "Fn::GetAtt": [
                        "bastionsg",
                        "GroupId"
                    ]
                },
                "IpProtocol": "TCP",
                "ToPort": "443"
            },
            "Type": "AWS::EC2::SecurityGroupEgress"
        }
    }
}
